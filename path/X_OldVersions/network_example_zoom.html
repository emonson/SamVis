<!DOCTYPE html>
<meta charset="utf-8">
<style>

.node {
  stroke: #333;
  stroke-width: 2px;
  fill: #000;
  fill-opacity: 0.3;
}

.link {
  stroke: #999;
  stroke-opacity: 0.5;
}

path.link {
  fill: #C29E84;
  fill-opacity: 1.0;
  stroke: none;
}

</style>
<body>
<script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>

<div id="chart"></div>

<script>

var w = 800,
    h = 800,
    fill = d3.scale.category20();

var outerGroup = d3.select("#chart")
  .append("svg:svg")
    .attr("width", w)
    .attr("height", h)
    .attr("pointer-events", "all")
  .append('svg:g')
    .call(d3.behavior.zoom().on("zoom", redraw));

outerGroup.append('svg:rect')
    .attr('width', w)
    .attr('height', h)
    .attr('fill', 'white');
  
var vis = outerGroup.append('svg:g');

function redraw() {
  vis.attr("transform",
      "translate(" + d3.event.translate + ")"
      + " scale(" + d3.event.scale + ")");
}

var force = d3.layout.force()
    .size([w, h])
		.charge(-120)
		.linkDistance(30);
		
d3.json("http://emo2.trinity.duke.edu/remote9004/json_20130813/transitiongraph", function(graph, error) {
	
	force
      .nodes(graph.nodes)
      .links(graph.edges)
      .start();

  var link = vis.selectAll(".link")
      .data(graph.edges)
    .enter().append("svg:path")
      .attr("class", "link");

  var node = vis.selectAll(".node")
      .data(graph.nodes)
    .enter().append("circle")
      .attr("class", "node")
      // .attr("r", 5)
      .attr("r", function(d){ return 0.25*Math.sqrt(d.t); })
      // .style("fill", function(d) { return color(d.group); })
      .call(force.drag);

  node.append("title")
      .text(function(d) { return d.i; });

  force.on("tick", function() {
    link.attr("d", function(d) {
    	var prec = 5;
    	var tx = d.target.x,
    			ty = d.target.y,
    			sx = d.source.x,
    			sy = d.source.y,
    			v = 0.5*Math.sqrt(d.v);
    	var d = Math.sqrt((tx-sx)*(tx-sx) + (ty-sy)*(ty-sy)),
    			vx = v*(ty-sy)/d,
    			vy = v*(tx-sx)/d;
    	var sxplus = sx + vx,
    			sxminus = sx - vx,
    			syplus = sy + vy,
    			syminus = sy - vy;
    	return "M" +
					tx.toPrecision(prec) + "," + ty.toPrecision(prec) + "L" +
					sxplus.toPrecision(prec) + "," + syminus.toPrecision(prec) + "L" +
					sxminus.toPrecision(prec) + "," + syplus.toPrecision(prec) + "Z";
    });

    node.attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });
  });
});
        
</script>