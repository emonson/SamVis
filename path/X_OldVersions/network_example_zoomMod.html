<!DOCTYPE html>
<meta charset="utf-8">
<style>

.node {
  stroke: #333;
  stroke-width: 2px;
  fill: #000;
  fill-opacity: 0.3;
}

.link {
  stroke: #999;
  stroke-opacity: 0.5;
}

path.link {
  fill: #C29E84;
  fill-opacity: 1.0;
  stroke: none;
}

.overlay {
	fill: white;
}

</style>
<script type="text/javascript" src="../../libs/d3_3.1.6/d3.v3.min.js"></script>
<body>

<div id="chart"></div>

<script>

var w = 600,
    h = 600,
    fill = d3.scale.category20();

var svg = d3.select("body").append("svg")
    .attr("width", w)
    .attr("height", h)
  .append("g")
    .call(d3.behavior.zoom().scaleExtent([0.25, 8]).on("zoom", zoom))
  .append("g");

svg.append("rect")
    .attr("class", "overlay")
    .attr("width", w)
    .attr("height", h);

var vis = svg.append("g");

function zoom() {
  vis.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
}

var force = d3.layout.force()
    .size([w, h])
		.charge(-120)
		.gravity(0.15)
		.linkDistance(30);
		
// d3.json("http://emo2.trinity.duke.edu/remote9004/json_20130927_img_d02/transitiongraph", function(error, graph) {
// d3.json("http://emo2.trinity.duke.edu/remote9004/json_20130913_ex3d/transitiongraph", function(error, graph) {
d3.json("http://emo2.trinity.duke.edu/remote9004/json_20130813/transitiongraph", function(error, graph) {
	
	force
      .nodes(graph.nodes)
      .links(graph.edges)
      .start();

  var link = vis.selectAll(".link")
      .data(graph.edges)
    .enter().append("svg:path")
      .attr("class", "link");

  var node = vis.selectAll(".node")
      .data(graph.nodes)
    .enter().append("circle")
      .attr("class", "node")
      // .attr("r", 5)
      .attr("r", function(d){ return 0.25*Math.sqrt(d.t); })
      // .style("fill", function(d) { return color(d.group); })
      .call(force.drag)
      // keep the node drag mousedown from triggering pan
    	.on("mousedown", function() { d3.event.stopPropagation(); });

  node.append("title")
      .text(function(d) { return d.i; });

  force.on("tick", function() {
    link.attr("d", function(d) {
    	var prec = 5;
    	var tx = d.target.x,
    			ty = d.target.y,
    			sx = d.source.x,
    			sy = d.source.y,
    			v = 0.5*Math.sqrt(d.v);
    	var d = Math.sqrt((tx-sx)*(tx-sx) + (ty-sy)*(ty-sy)),
    			vx = v*(ty-sy)/d,
    			vy = v*(tx-sx)/d;
    	var sxplus = sx + vx,
    			sxminus = sx - vx,
    			syplus = sy + vy,
    			syminus = sy - vy;
    	return "M" +
					tx.toPrecision(prec) + "," + ty.toPrecision(prec) + "L" +
					sxplus.toPrecision(prec) + "," + syminus.toPrecision(prec) + "L" +
					sxminus.toPrecision(prec) + "," + syplus.toPrecision(prec) + "Z";
    });

    node.attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });
  });
});
        
</script>